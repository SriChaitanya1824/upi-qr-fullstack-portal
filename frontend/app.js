const apiBase=window.location.origin;const f=document.getElementById('qrForm');const a=document.getElementById('qrArea');const q=document.getElementById('qrcode');const u=document.getElementById('upiUri');const p=document.getElementById('paidBtn');let id=null;f.addEventListener('submit',async e=>{e.preventDefault();q.innerHTML='';a.classList.add('hidden');const upi=document.getElementById('upiId').value.trim();const n=document.getElementById('payeeName').value.trim();const am=document.getElementById('amount').value.trim();const note=document.getElementById('note').value.trim();const r=await fetch(apiBase+'/api/create-qr',{method:'POST',headers:{'content-type':'application/json'},body:JSON.stringify({upiId:upi,payeeName:n,amount:am,note})});const d=await r.json();if(!r.ok)return alert(d.error);id=d.txnId;u.textContent=d.upiUri;new QRCode(q,{text:d.upiUri,width:220,height:220});a.classList.remove('hidden');});p.addEventListener('click',async()=>{if(!id)return alert('No transaction');const tx=prompt('Enter payment reference');const r=await fetch(apiBase+'/api/confirm-payment',{method:'POST',headers:{'content-type':'application/json'},body:JSON.stringify({txnId:id,paymentTxnId:tx,status:'paid'})});const d=await r.json();if(!r.ok)return alert(d.error);alert('Payment marked paid');});const ff=document.getElementById('feedbackForm');ff.addEventListener('submit',async e=>{e.preventDefault();const t=document.getElementById('fbTxnId').value.trim()||undefined;const ty=document.getElementById('fbType').value;const ra=parseInt(document.getElementById('rating').value)||undefined;const m=document.getElementById('fbMessage').value.trim();if(!m)return;const r=await fetch(apiBase+'/api/feedback',{method:'POST',headers:{'content-type':'application/json'},body:JSON.stringify({transactionId:t,type:ty,rating:ra,message:m})});const d=await r.json();if(!r.ok)return alert(d.error);document.getElementById('fbMessage').value='';document.getElementById('fbResult').textContent='Submitted';});